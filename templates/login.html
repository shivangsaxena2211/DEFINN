<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>DEFINN | Decentralized Finance Network</title>

  <script src="https://cdn.tailwindcss.com"></script>

  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Rajdhani:wght@300;500;700&display=swap" rel="stylesheet" />

  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: {
            sans: ["Rajdhani", "sans-serif"],
            brand: ["Orbitron", "sans-serif"],
          },
          colors: {
            "definn-blue": "#00f3ff",
            "definn-green": "#00ff9d",
            glass: "rgba(255, 255, 255, 0.05)",
          },
          animation: {
            "pulse-slow": "pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite",
          },
        },
      },
    };
  </script>

  <style>
    .glass-panel {
      background: rgba(255, 255, 255, 0.05);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      border: 1px solid rgba(255, 255, 255, 0.08);
      box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.5);
    }

    body {
      background: linear-gradient(-45deg, #0f172a, #1e1b4b, #000000, #111827);
      background-size: 400% 400%;
      animation: gradientBG 15s ease infinite;
      height: 100vh;
    }

    @keyframes gradientBG {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }

    .neon-text-blue { text-shadow: 0 0 10px rgba(0, 243, 255, 0.5); }
    .neon-text-green { text-shadow: 0 0 10px rgba(0, 255, 157, 0.5); }
  </style>
</head>

<body class="flex items-center justify-center overflow-hidden relative">

  <div class="absolute top-1/4 left-1/4 w-64 h-64 bg-definn-blue/20 rounded-full blur-[100px] animate-pulse-slow"></div>
  <div class="absolute bottom-1/4 right-1/4 w-64 h-64 bg-definn-green/20 rounded-full blur-[100px] animate-pulse-slow" style="animation-delay: 1.5s;"></div>

  <div class="relative w-full max-w-[400px] p-8 mx-4 rounded-2xl glass-panel z-10 border-t border-white/10">

    <div class="text-center mb-10">
      <h1 class="text-5xl font-black font-brand tracking-widest mb-2">
        <span class="text-definn-blue neon-text-blue">DE</span><span class="text-definn-green neon-text-green">FINN</span>
      </h1>
      <div class="h-px w-24 mx-auto bg-gradient-to-r from-transparent via-white/30 to-transparent mb-3"></div>
      <p class="text-sm text-cyan-100/60 font-medium tracking-[0.3em] uppercase">Future of Finance</p>
    </div>

    <div class="grid grid-cols-2 gap-2 p-1 bg-black/40 rounded-lg mb-8 border border-white/5">
      <button id="tab-login" onclick="switchTab('login')" class="py-2.5 text-sm font-bold rounded bg-white/10 text-white shadow transition-all tracking-wider">
        LOGIN
      </button>
      <button id="tab-register" onclick="switchTab('register')" class="py-2.5 text-sm font-bold rounded text-gray-500 hover:text-white hover:bg-white/5 transition-all tracking-wider">
        REGISTER
      </button>
    </div>

    <form id="login-form" class="space-y-5" onsubmit="handleLogin(event); return false;">
      <div class="space-y-1">
        <label class="text-xs text-definn-blue font-bold tracking-widest ml-1">EMAIL</label>
        <input id="loginEmail" type="email" required placeholder="admin@definn.com"
          class="w-full bg-black/30 border border-white/10 rounded-lg px-4 py-3 text-white placeholder-gray-600 focus:outline-none focus:border-definn-blue focus:ring-1 focus:ring-definn-blue transition-all font-sans" />
      </div>

      <div class="space-y-1">
        <label class="text-xs text-definn-blue font-bold tracking-widest ml-1">PASSKEY</label>
        <input id="loginPassword" type="password" required placeholder="••••••••"
          class="w-full bg-black/30 border border-white/10 rounded-lg px-4 py-3 text-white placeholder-gray-600 focus:outline-none focus:border-definn-blue focus:ring-1 focus:ring-definn-blue transition-all font-sans" />

        <div class="flex justify-end pt-1">
          <a href="#" onclick="forgotPasskey(); return false;" class="text-[11px] text-cyan-300/60 hover:text-definn-blue hover:underline tracking-wider transition-colors">
            FORGOT PASSKEY?
          </a>
        </div>
      </div>

      <button id="loginBtn" type="submit"
        class="w-full bg-gradient-to-r from-cyan-600 to-blue-600 hover:from-cyan-500 hover:to-blue-500 text-white font-brand font-bold py-3.5 rounded-lg shadow-lg shadow-cyan-900/20 transform transition active:scale-[0.98] border border-cyan-400/20">
        INITIATE SESSION
      </button>

      <p id="loginMsg" class="text-center text-sm font-semibold mt-2"></p>
    </form>

    <form id="register-form" class="space-y-4 hidden" onsubmit="handleRegister(event); return false;">
      <div class="grid grid-cols-2 gap-3">
        <input id="regFirst" type="text" required placeholder="First Name"
          class="bg-black/30 border border-white/10 rounded-lg px-4 py-3 text-white focus:border-definn-green focus:outline-none focus:ring-1 focus:ring-definn-green transition-all" />
        <input id="regLast" type="text" required placeholder="Last Name"
          class="bg-black/30 border border-white/10 rounded-lg px-4 py-3 text-white focus:border-definn-green focus:outline-none focus:ring-1 focus:ring-definn-green transition-all" />
      </div>

      <input id="regEmail" type="email" required placeholder="user@definn.com"
        class="w-full bg-black/30 border border-white/10 rounded-lg px-4 py-3 text-white focus:border-definn-green focus:outline-none focus:ring-1 focus:ring-definn-green transition-all" />

      <input id="regPassword" type="password" required placeholder="Create Passkey"
        class="w-full bg-black/30 border border-white/10 rounded-lg px-4 py-3 text-white focus:border-definn-green focus:outline-none focus:ring-1 focus:ring-definn-green transition-all" />

      <button id="registerBtn" type="submit"
        class="w-full bg-gradient-to-r from-emerald-600 to-green-600 hover:from-emerald-500 hover:to-green-500 text-white font-brand font-bold py-3.5 rounded-lg shadow-lg shadow-emerald-900/20 transform transition active:scale-[0.98] border border-green-400/20">
        CREATE IDENTITY
      </button>

      <p id="registerMsg" class="text-center text-sm font-semibold mt-2"></p>
    </form>

  </div>

  <script>
    const BASE_URL = "http://localhost:3000";
    const DASHBOARD_URL = `${BASE_URL}/dashboard`;

    window.addEventListener("DOMContentLoaded", async () => {
      try {
        const res = await fetch(`${BASE_URL}/api/me`, {
          method: "GET",
          credentials: "include"
        });
        const data = await res.json();
        if (data.logged_in) {
          window.location.href = DASHBOARD_URL;
        }
      } catch (e) {
      }
    });

    function switchTab(tab) {
      const loginForm = document.getElementById("login-form");
      const registerForm = document.getElementById("register-form");
      const loginBtn = document.getElementById("tab-login");
      const registerBtn = document.getElementById("tab-register");

      if (tab === "login") {
        loginForm.classList.remove("hidden");
        registerForm.classList.add("hidden");
        loginBtn.className = "py-2.5 text-sm font-bold rounded bg-white/10 text-white shadow transition-all tracking-wider";
        registerBtn.className = "py-2.5 text-sm font-bold rounded text-gray-500 hover:text-white hover:bg-white/5 transition-all tracking-wider";
      } else {
        loginForm.classList.add("hidden");
        registerForm.classList.remove("hidden");
        registerBtn.className = "py-2.5 text-sm font-bold rounded bg-white/10 text-white shadow transition-all tracking-wider";
        loginBtn.className = "py-2.5 text-sm font-bold rounded text-gray-500 hover:text-white hover:bg-white/5 transition-all tracking-wider";
      }
    }

    function setMsg(el, text, ok = false) {
      el.textContent = text;
      el.className = `text-center text-sm font-semibold mt-2 ${ok ? "text-green-400" : "text-red-400"}`;
    }

    async function handleRegister(e) {
      e.preventDefault();

      const first = document.getElementById("regFirst").value.trim();
      const last = document.getElementById("regLast").value.trim();
      const email = document.getElementById("regEmail").value.trim().toLowerCase();
      const password = document.getElementById("regPassword").value.trim();
      const msg = document.getElementById("registerMsg");

      const registerBtn = document.getElementById("registerBtn");
      registerBtn.disabled = true;
      registerBtn.textContent = "CREATING...";

      try {
        const res = await fetch(`${BASE_URL}/api/register`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          credentials: "include",
          body: JSON.stringify({
            name: `${first} ${last}`,
            email,
            password
          })
        });

        const data = await res.json();

        if (!res.ok) {
          setMsg(msg, data.error || "Registration failed");
          return;
        }

        setMsg(msg, "Identity created! Please login.", true);

        setTimeout(() => {
          switchTab("login");
        }, 900);

      } catch (err) {
        setMsg(msg, "Server not reachable. Start Flask backend.");
      } finally {
        registerBtn.disabled = false;
        registerBtn.textContent = "CREATE IDENTITY";
      }
    }

    async function handleLogin(e) {
      e.preventDefault();

      const email = document.getElementById("loginEmail").value.trim().toLowerCase();
      const password = document.getElementById("loginPassword").value.trim();
      const msg = document.getElementById("loginMsg");

      const loginBtn = document.getElementById("loginBtn");
      loginBtn.disabled = true;
      loginBtn.textContent = "CONNECTING...";

      try {
        const res = await fetch(`${BASE_URL}/api/login`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          credentials: "include",  
          body: JSON.stringify({ email, password })
        });

        const data = await res.json();

        if (!res.ok) {
          setMsg(msg, data.error || "Login failed");
          return;
        }

        setMsg(msg, "Login successful. Redirecting...", true);

        window.location.href = DASHBOARD_URL;

      } catch (err) {
        setMsg(msg, "Server not reachable. Start Flask backend.");
      } finally {
        loginBtn.disabled = false;
        loginBtn.textContent = "INITIATE SESSION";
      }
    }

    function forgotPasskey() {
      alert("Password recovery not implemented yet. (Demo)");
    }
  </script>

</body>
</html>
